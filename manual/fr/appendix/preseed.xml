<?xml version="1.0" encoding="ISO-8859-1"?>
<!-- original version: 32512 -->

<!--
Be carefull with the format of this file as it is parsed to generate
the example preseed file.
In that file all text between <informalexample> tags that have the
attribute 'role="example"' set is included, except if a 'condition'
attribute is in force that does not match the specified release or if an
'arch' attribute is in force that does not match the specified architecture.

Currently only a single variant of the example file is generated (for i386).
-->

<appendix id="appendix-preseed" condition="etch">
<title>Automatisation de l'installation et préconfiguration</title>

<para>

Dans cette annexe du manuel, nous verrons les problèmes que pose la préconfiguration
des réponses aux questions de l'installateur en vue d'automatiser l'installation.

</para><para>

Les éléments de configuration utilisés dans cette annexe sont aussi disponibles en tant que
fichier dans &urlset-example-preseed;.

</para>

 <sect1 id="preseed-intro">
 <title>Introduction</title>
<para>

La préconfiguration est une façon de donner des réponses à des questions sans
avoir à les saisir pendant le processus d'installation. Cela rend possible une 
automatisation complète de ce processus et cela offre même des fonctionnalités qui
ne sont pas disponibles autrement.

</para><para>

Avec la préconfiguration, on peut répondre aux questions qui sont posées pendant
la première partie de l'installation (avant le lancement du nouveau système)
et pendant la deuxième partie.

</para>

  <sect2 id="preseed-methods">
  <title>Les méthodes</title>
<para>

La préconfiguration peut être faite de trois manières différentes&nbsp;:
<firstterm>initrd</firstterm>, <firstterm>file</firstterm> et
<firstterm>network</firstterm>. La méthode qui utilise <quote>initrd</quote> est compatible
avec tous les types d'installation et offre toutes les possibilités mais elle
demande une préparation soignée. Les méthodes <quote>file</quote> et<quote>network</quote>
sont compatibles avec plusieurs types d'installation mais les toutes premières
questions de l'installateur ne peuvent pas être préconfigurées puisque le fichier
de préconfiguration est chargé <quote>après</quote> que ces questions ont été posées.

</para><para>

Le tableau suivant montre les relations entre les méthodes d'installation et les 
méthodes de préconfiguration.

<informaltable>
<tgroup cols="4">
<thead>
<row>
  <entry>Méthode d'installation</entry><entry>initrd</entry>
  <entry>file</entry><entry>network</entry>
</row>
</thead>

<tbody>
<row>
  <entry>CD/DVD</entry>
  <entry>oui</entry>
  <entry>oui</entry>
  <entry>non</entry>
</row><row>
  <entry>network</entry>
  <entry>oui</entry>
  <entry>non</entry>
  <entry>oui</entry>
</row><row>
  <entry>disque dur <phrase condition="bootable-usb">(clé usb)</phrase></entry>
  <entry>oui</entry>
  <entry>oui</entry>
  <entry>non</entry>
</row><row condition="supports-floppy-boot">
  <entry>disquettes (pilotes cd)</entry>
  <entry>oui</entry>
  <entry>oui</entry>
  <entry>non</entry>
</row><row condition="supports-floppy-boot">
  <entry>disquettes (pilotes réseau)</entry>
  <entry>oui</entry>
  <entry>non</entry>
  <entry>oui</entry>
</row><row arch="s390">
  <entry>bandes</entry>
  <entry>oui</entry>
  <entry>non</entry>
  <entry>oui</entry>
</row>
</tbody>

</tgroup></informaltable>

</para><para>

Le moment où le fichier de préconfiguration est chargé et exécuté est une
différence fondamentale entre les diverses méthodes de préconfiguration.
Avec l'initrd, ce fichier est chargé au tout début de l'installation, avant même
qu'une seule question soit posée. Avec la méthode <quote>file</quote>,
il faut que le cédérom (ou une image) ait été chargé. Avec la méthode <quote>network</quote>,
le réseau doit avoir été préalablement configuré.

</para><para>

Cela signifie que dans le cas d'une préconfiguration avec la méthode <quote>file</quote> ou 
la méthode <quote>network</quote>, les questions sur la langue, le pays et le clavier 
ont déjà été posées.
Quand le fichier est sur le réseau, il faut ajouter à cela la configuration du réseau.
D'autres questions, qui ne sont visibles qu'avec une priorité de type medium ou basse,
comme par exemple lors de la première phase de détection du matériel, auront déjà été
posées.

</para><para>

Il est donc clair que toutes les questions posées avant que le fichier de
préconfiguration n'ait été chargé ne peuvent pas être préconfigurées.
La section <xref linkend="preseed-bootparms"/> montre comment éviter que ces
questions soient posées.

</para>
  </sect2>

  <sect2 id="preseed-limitations">
  <title>Limitations</title>
<para>

La plupart des dialogues de l'installateur Debian peuvent être
préconfigurés de cette manière. Il y a cependant des exceptions
notables. On doit partitionner tout un disque ou partitionner
une partie de l'espace disponible&nbsp;; on ne peut pas utiliser des
partitions existantes .
On ne peut pas installer RAID et LVM en utilisant cette méthode.

</para>
  </sect2>

<!-- Joeyh feels this is too technical, so leave it out for now

  <sect2 id="preseed-debconf">
  <title>Debconf</title>
<para>

La préconfiguration utilise les possibilités offertes 
dans le cadre de <classname>debconf</classname>. Ce programme est le programme 
choisi par Debian pour gérer les interactions avec l'utilisateur pendant 
la configuration des paquets. C'est aussi le coeur de l'installateur.
Les dialogues reposent sur des <quote>questions</quote>. Ces questions
peuvent être de différents types. Les questions rééllement posées sont
<quote>générées</quote> au moment de l'exécution à partir de leur type.
Plusieurs questions peuvent partager le même type.

</para><para>

Les types suivants sont utilisés pour la préconfiguration :

</para>

<itemizedlist>
<listitem><para>
  string: l'utilisateur saisit une valeur
</para></listitem>
<listitem><para>
  password: semblable à string mais la valeur saisie n'est pas affichée
</para></listitem>
<listitem><para>
  boolean: pour des questions de type oui/non ou vrai/faux
</para></listitem>
<listitem><para>
  select: l'utilisateur choisit une option dans une liste
</para></listitem>
<listitem><para>
  multiselect: l'utilisateur choisit une option ou aucune ou plusieurs, dans une liste
</para></listitem>
<listitem><para>
  note: affiche un message
</para></listitem>
</itemizedlist>

<para>

Pour l'installateur, les questions sont placées dans un fichier lisible,
<filename>/var/cache/debconf/templates.dat</filename, qui contient tous les textes et leurs
traductions. Il peut aussir contenir des valeurs par défaut pour les
questions. Le texte peut contenir des variables qui seront remplacées au moment de
l'exécution.

</para><para>

Les valeurs des variables et les réponses aux questions sont dans un autre
fichier lisible, <filename>/var/cache/debconf/questions.dat</filename>. Une question
renvoie toujours au type utilisé pour la poser. Pour d'évidentes raisons de
sécurité, les réponses aux questions de type <quote>password</quote> sont
placées dans un fichier distinct non lisible du même répertoire.

</para>
  </sect2>
-->
  <sect2 id="preseed-hooks">
  <title>Exécuter ses propres commandes pendant l'installation</title>
<para>

Une option pratique et très puissante offerte par les outils de préconfiguration
est la possibilité d'exécuter des commandes ou de lancer des scripts à certains
moments de l'installation. Voyez <xref linkend="preseed-shell"/> pour des précisions.

</para>

<itemizedlist>
<listitem><para>
  <userinput>preseed/early_command</userinput> : commande lancée dès que le fichier
  de préconfiguration a été chargé
</para></listitem>
<listitem><para>
  <userinput>preseed/late_command</userinput> : commande lancée juste avant le redémarrage,
  à la fin de la première partie de l'installation, mais avant que le système de fichiers 
  <filename>/target</filename> ait été démonté
</para></listitem>
<listitem><para>
  <userinput>base-config/early_command</userinput> : commande lancée au début de la
  deuxième partie de l'installation, quand <command>base-config</command> débute
</para></listitem>
<listitem><para>
  <userinput>base-config/late_command</userinput> : commande lancée à la fin de
  <command>base-config</command>, juste avant l'invite de connexion
</para></listitem>
</itemizedlist>

  </sect2>

  <sect2 id="preseed-seenflag">
  <title>Modifier les valeurs par défaut avec la préconfiguration</title>
<para>

Avec la préconfiguration, on peut modifier la valeur par défaut
d'une réponse à une question, question qui sera, malgré cela, posée.
Il suffit de positionner le drapeau <firstterm>seen</firstterm> à <quote>false</quote>
après avoir indiqué cette valeur.

</para>

<informalexample><screen>
d-i foo/bar string value
d-i foo/bar seen false
</screen></informalexample>

  </sect2>
 </sect1>

 <sect1 id="preseed-using">
 <title>Utiliser la préconfiguration</title>
<para>

Vous devez d'abord créer le fichier de préconfiguration et le placer là où vous
le voulez. Cette création est abordée plus loin dans l'annexe. Mettre ce fichier au bon endroit
est simple si vous voulez le lire sur le réseau, sur une disquette ou sur une clé usb.
Si vous voulez inclure ce fichier sur un cédérom vous devrez recréer l'image iso.
Expliquer comment le mettre dans l'initrd ne sera pas fait dans cette annexe. Veuillez
consulter la documentation des développeurs de l'installateur.

</para>
<para>
Un exemple de fichier de préconfiguration basé sur les éléments de cette annexe
est disponible dans &urlset-example-preseed;.
Vous pouvez vous servir de ce fichier pour créer le votre.
</para>

  <sect2 id="preseed-loading">
  <title>Charger le fichier de préconfiguration</title>
<para>

Quand on utilise l'initrd, il faut être sûr qu'un fichier appelé
<filename>preseed.cfg</filename> se trouve dans le répertoire racine
de l'initrd. L'installateur recherche ce fichier et le charge s'il est présent.

</para><para>

Avec les autres méthodes de préconfiguration, vous devez dire à l'installateur
quel fichier charger au moment de l'amorçage de l'installateur.
On peut passer un paramètre au noyau soit au moment de l'amorçage soit en modifiant
le fichier de configuration du programme d'amorçage (par exemple
<filename>syslinux.cfg</filename>) et en ajoutant le paramètre à la fin des lignes
<quote>append</quote>.

</para><para>

Si vous avez indiqué le fichier de préconfiguration dans le fichier de configuration 
du programme d'amorçage, vous pourriez modifier la configuration pour ne pas avoir à
appuyer sur la touche <quote>Entrée</quote> pour lancer l'installateur.
Avec syslinux, il suffit de mettre le délai d'attente à 1 dans
<filename>syslinux.cfg</filename>.

</para><para>

Pour être sûr que l'installateur charge le bon fichier de préconfiguration
vous pouvez indiquer une somme de contrôle pour ce fichier. Cette somme doit
être pour l'instant de type md5sum. Quand elle est spécifiée, elle doit correspondre
au fichier sinon l'installateur refusera de charger le fichier.

</para>

<informalexample><screen>
Paramètres à indiquer :
- quand l'amorçage se fait sur le réseau :
  preseed/url=http://host/path/to/preseed.cfg
  preseed/url/checksum=5da499872becccfeda2c4872f9171c3d

- quand l'amorçage se fait sur un cédérom modifié :
  preseed/file=/cdrom/preseed.cfg
  preseed/file/checksum=5da499872becccfeda2c4872f9171c3d

- quand l'amorçage se fait sur une clé USB (le fichier
  est dans le répertoire racine de la clé) :
  preseed/file=/hd-media/preseed.cfg
  preseed/file/checksum=5da499872becccfeda2c4872f9171c3d
</screen></informalexample>

<para>

Pendant que vous y êtes, vous pourriez déclarer un 
<userinput>debconf/priority=critical</userinput> pour éviter la plupart des questions, 
même si la préconfiguration qui suit ne les aborde pas.

</para>
  </sect2>

  <sect2 id="preseed-bootparms">
  <title>Utiliser les paramètres d'amorçage pour compléter la préconfiguration</title>
<para>

On ne peut pas automatiser certaines étapes de l'installation avec certains types
de préconfiguration car les questions sont posées avant que le fichier
ne soit chargé. Si par exemple le fichier est téléchargé sur le réseau, la
configuration du réseau doit être faite préalablement. L'une des raisons d'utiliser
la préconfiguration avec initrd est qu'il est alors possible de préconfigurer
ces étapes.

</para><para>

Quand on ne peut pas utiliser un fichier de préconfiguration pour préconfigurer
certaines étapes, on peut quand même automatiser l'installation car il est possible
de passer des paramètres au noyau sur la ligne de commande. Il suffit d'indiquer
une paire de type <userinput>path/to/variable=valeur</userinput> 
pour toutes les variables listées dans les exemples.

</para>
<note><para>

Il faut savoir que le noyau accepte un maximum de huit options ligne de
de commandes et huit variables d'environnement. Et les options ajoutées
par l'installateur sont comprises dans ces chiffres. S'il y a dépassement,
les noyaux 2.4 ignorent les options en trop et les noyaux 2.6 paniquent.
À partir des noyaux 2.6.9, vous pouvez employer 32 options ligne de
commandes et 32 variables d'environnement.

</para></note>
<para>

On peut sans risque supprimer certaines options par défaut, comme 
'vga=normal'. Cela permet de rajouter autant d'options
pour la préconfiguration.

</para>
<note><para>

Il n'est pas toujours possible d'indiquer des valeurs contenant des espaces 
dans les paramètres d'amorçage, même encadrés par des guillemets.

</para></note>
  </sect2>
 </sect1>

 <sect1 condition="FIXME" id="preseed-creating">
 <title>Créer un fichier de préconfiguration</title>
<para>

Le format de ce fichier est celui de la commande 
<command>debconf-set-selections</command>.

</para>

<itemizedlist>
<listitem><para>
  Format du fichier
</para></listitem>
<listitem><para>
  Un seul espace autorisé entre le type de la question et la valeur
</para></listitem>
<listitem><para>
  Relation avec /var/lib/(c)debconf/templates
</para></listitem>
<listitem><para>
  Types des questions et manière de leur donner une valeur
</para></listitem>
<listitem><para>
  La plupart des valeurs doivent être en anglais
</para></listitem>
<listitem><para>
  Se servir d'une installation normalement effectuée
</para></listitem>
<listitem><para>
  Trouver d'autres valeurs possibles
</para></listitem>
</itemizedlist>

<para>

Pour vérifier le format de votre fichier de préconfiguration avant de
commencer une installation, vous pouvez utiliser la commande 
<command>debconf-set-selections -c <replaceable>preseed.cfg</replaceable></command>.

</para>
 </sect1>

 <sect1 id="preseed-stage1">
 <title>Préconfigurer la première partie de l'installation</title>
<para>

Un exemple de fichier de préconfiguration basé sur les éléments de cette annexe
est disponible dans &urlset-example-preseed;.

</para><para>

Les exemples donnés ici sont valables pour l'architecture Intel x86.
Si vous utilisez une autre architecture, certains exemples, comme la préconfiguration 
du clavier ou du programme d'amorçage, ne seront pas appropriés et vous devrez les
modifier avec les valeurs adéquates.

</para>
 
  <sect2 id="preseed-l10n">
  <title>Localisation</title>
<para>

Choisir la langue et le pays ne fonctionne qu'avec une préconfiguration de type initrd.
Pour les autres formes de préconfiguration, le fichier de préconfiguration n'est chargé
qu'après que les questions ont été posées

</para><para>

Une locale peut être choisie pour indiquer à la fois la langue et le pays.
Pour indiquer une locale sous forme de paramètre d'amorçage, écrivez :
<userinput>debian-installer/locale=<replaceable>fr_FR</replaceable></userinput>.

<informalexample role="example"><screen>
# indiquer à la fois la langue et le pays :
d-i debian-installer/locale string fr_FR
</screen></informalexample>

</para><para>

La configuration du clavier consiste à déclarer son architecture et la carte clavier.
La plupart du temps le type est correctement détecté et il n'y a pas besoin de
le préconfigurer. La carte clavier doit être compatible avec le type du clavier.

<informalexample role="example"><screen>
# Choix du clavier.
#d-i console-tools/archs select at
d-i console-keymaps-at/keymap select us
# Une architecture différente
#d-i console-keymaps-usb/keymap select mac-usb-us
</screen></informalexample>

</para><para>

Pour éviter la configuration du clavier, préconfigurez
<classname>console-tools/archs</classname> avec
<userinput>skip-config</userinput>.
La carte clavier du noyau restera active.

</para>

<note><para>

Les modifications apportées à la gestion des entrées par les noyaux 2.6 ont rendu presque
obsolète l'architecture des claviers. Normalement, une carte clavier <quote>PC</quote>
(<userinput>at</userinput>) devrait être sélectionnée.

</para></note>
  </sect2>

  <sect2 id="preseed-network">
  <title>Configuration du réseau</title>
<para>

Bien sûr, si vous récupérez le fichier de préconfiguration sur le réseau,
cela ne marchera pas ! Mais c'est parfait si vous amorcez à partir d'un
cédérom ou d'une clé USB. Vous pouvez aussi ajouter des paramètres réseau
aux paramètres du noyau si vous récupérez le fichier de préconfiguration 
sur le réseau.

</para>

<informalexample role="example"><screen>
#Netcfg choisira une interface connectée si possible. Cela empêchera d'afficher
#une liste s'il y a plusieurs interfaces.
d-i netcfg/choose_interface select auto

#Quand le serveur dhcp est lent et que l'installateur s'arrête pour l'attendre,
#ceci peut être utile.
#d-i netcfg/dhcp_timeout string 60

# Si vous préférez configurer vous-même le réseau, voici comment faire :
#d-i netcfg/disable_dhcp boolean true
#d-i netcfg/get_nameservers string 192.168.1.1
#d-i netcfg/get_ipaddress string 192.168.1.42
#d-i netcfg/get_netmask string 255.255.255.0
#d-i netcfg/get_gateway string 192.168.1.1
#d-i netcfg/confirm_static boolean true

# Remarquez que les valeurs données par dhcp, nom de domaine ou nom de 
# machine, prennent le pas sur les valeurs déclarées ici. Cependant,
# cette déclaration empêche que les questions ne soient posées même si les
# valeurs viennent de dhcp.
d-i netcfg/get_hostname string unassigned-hostname
d-i netcfg/get_domain string unassigned-domain

# Supprimer le dialogue irritant sur la clé WEP.
d-i netcfg/wireless_wep string
# Et l'étonnant nom de machine dhcp que certains FAI utilisent comme mot de
# passe.
#d-i netcfg/dhcp_hostname string radish
</screen></informalexample>

  </sect2>

  <sect2 id="preseed-mirror">
  <title>Valeurs pour les miroirs</title>
<para>

Selon la méthode d'installation choisie, vous pouvez utiliser un miroir, aussi bien
pour télécharger le système de base et des composants supplémentaires que pour
configurer le fichier <filename>/etc/apt/sources.list</filename>.

</para><para>

Le paramètre <classname>mirror/suite</classname> détermine la distribution pour le
système à installer.

</para><para>

Le paramètre <classname>mirror/udeb/suite</classname> détermine la distribution
des composants supplémentaires de l'installateur. On s'en sert uniquement
quand ces composants sont récupérés sur le réseau et qu'ils doivent correspondre
à la distribution utilisée pour construire l'initrd nécessaire à la méthode
d'installation. Par défaut, la valeur de <classname>mirror/udeb/suite</classname>
est égale à celle de <classname>mirror/suite</classname>.

</para>

<informalexample role="example"><screen>
d-i mirror/country string enter information manually
d-i mirror/http/hostname string http.us.debian.org
d-i mirror/http/directory string /debian
d-i mirror/http/proxy string

# Distribution à installer.
#d-i mirror/suite string testing
# Distribution à utiliser pour charger les composants de l'installateur (facultatif).
#d-i mirror/udeb/suite string testing
</screen></informalexample>

  </sect2>

  <sect2 id="preseed-partman">
  <title>Partitionnement</title>
<para>

Préconfigurer le partitionnement du disque dur est limité aux possibilités offertes
par <classname>partman-auto</classname>. Vous pouvez partitionner un disque entier
ou seulement un espace libre sur ce disque. La disposition du disque peut être
indiquée par un schéma prédefini, un schéma inclus dans un fichier de schémas ou un
schéma mis dans dans le fichier de préconfiguration. Pour l'instant, on ne peut pas
préconfigurer le partitionnement de plusieurs disques ni la mise en &oelig;uvre de RAID et
LVM.

</para>

<warning><para>

L'identification des disques dépend de l'ordre de chargement des pilotes des
disques. Si le système possède plusieurs disques, assurez-vous que le bon
sera choisi avant de préconfigurer son partitionnement.

</para></warning>

<informalexample role="example"><screen>
# Si le système possède un espace libre, vous pouvez ne partitionner que cet
# espace.
#d-i partman-auto/init_automatically_partition	\
#    select Use the largest continuous free space


# Vous pouvez aussi choisir un disque entier. Le format de son nom peut être
# donné selon le format devfs ou le format traditionnel.
# Par exemple, pour utiliser le premier disque connu sous devfs :
d-i partman-auto/disk string /dev/discs/disc0/disc

# Vous pouvez choisir parmi tous les schémas prédéfinis...
d-i partman-auto/choose_recipe \
    select All files in one partition (recommended for new users)
#d-i partman-auto/choose_recipe \
#   select Separate /home partition
#d-i partman-auto/choose_recipe \
#   select Separate /home, /usr, /var, and /tmp partitions

#...ou donner vous-même votre schéma.
# Le format des schémas est expliqué dans le fichier 
# devel/partman-auto-recipe.txt.
# Si vous avez la possibilité d'obtenir un schéma dans l'environnement de
# l'installateur, vous pouvez simplement pointer sur lui.
#d-i partman-auto/expert_recipe_file string /hd-media/recipe

# Sinon, vous pouvez écrire un schéma en une seule ligne. L'exemple suivant
# crée une petite partition /boot, une partition swap convenable, et utilise le
# reste de l'espace libre pour la partition racine :
#d-i partman-auto/expert_recipe string                         \
#      boot-root ::                                            \
#              40 50 100 ext3                                  \
#                      $primary{ } $bootable{ }                \
#                      method{ format } format{ }              \
#                      use_filesystem{ } filesystem{ ext3 }    \
#                      mountpoint{ /boot }                     \
#              .                                               \
#              500 10000 1000000000 ext3                       \
#                      method{ format } format{ }              \
#                      use_filesystem{ } filesystem{ ext3 }    \
#                      mountpoint{ / }                         \
#              .                                               \
#              64 512 300% linux-swap                          \
#                      method{ swap } format{ }                \
#              .

# Partman créera automatiquement les partitions sans demander de confirmation.
d-i partman/confirm_write_new_label boolean true
d-i partman/choose_partition \
   select Finish partitioning and write changes to disk
d-i partman/confirm boolean true
</screen></informalexample>

  </sect2>

  <sect2 id="preseed-time">
  <title>Configuration du fuseau horaire</title>

<informalexample role="example"><screen>
# Cette commande règle l'horloge matérielle sur UTC :
d-i clock-setup/utc boolean true

# Vous pouvez mettre toute valeur acceptée pour $TZ.
# Voyez ce que contient /usr/share/zoneinfo/ pour des options.
d-i time/zone string US/Eastern
</screen></informalexample>

  </sect2>

  <sect2 id="preseed-apt">
  <title>Configuration d'Apt</title>
<para>

La création du fichier <filename>/etc/apt/sources.list</filename> 
et les principales options de configuration se font automatiquement à partir
de la méthode d'installation choisie et des réponses aux précédentes questions.
Seules les deux variables suivantes relèvent de la préconfiguration.
</para>

<informalexample role="example"><screen>
# Vous pouvez installer des logiciels des distributions non-free et contrib.
#d-i apt-setup/non-free boolean true
#d-i apt-setup/contrib boolean true
</screen></informalexample>

</sect2>

  <sect2 id="preseed-account">
  <title>Configuration des comptes</title>
<para>

Le mot de passe de root et le nom et le mot de passe d'un premier utilisateur
peuvent être préconfigurés. Pour les mots de passe, vous pouvez utiliser
simplement du texte ou bien utiliser le <emphasis>hachage</emphasis> MD5.

</para>
<warning><para>

Il faut être conscient que la préconfiguration des mots de passe n'est pas
entièrement sécurisée. On peut en effet lire le fichier de préconfiguration 
quand on y a accès et donc connaître les mots de passe. Le hachage MD5 semble 
meilleur en termes de sécurité. Cependant il peut donner un faux sentiment de sécurité
car un accès au hachage MD5 permet les attaques en force.

</para></warning>

<informalexample role="example"><screen>
#Le mot de passe de root en clair...
#passwd passwd/root-password password r00tme
#passwd passwd/root-password-again password r00tme
# ... ou chiffré avec un hachage MD5
#passwd passwd/root-password-crypted password [MD5 hash]

# Si vous voulez ne pas créer d'utilisateur :
#passwd passwd/make-user boolean false

# Vous pouvez aussi présélectionner le nom de l'utilisateur et son identifiant
# de connexion
#passwd passwd/user-fullname string Debian User
#passwd passwd/username string debian
# Mot de passe de l'utilisateur en clair...
#passwd passwd/user-password password insecure
#passwd passwd/user-password-again password insecure
# ... ou chiffré avec un hachage MD5
#passwd passwd/user-password-crypted password [MD5 hash]
</screen></informalexample>

<para>

Les variables <classname>passwd/root-password-crypted</classname> et
<classname>passwd/user-password-crypted</classname> peuvent être aussi
préconfigurées avec la valeur <quote>!</quote>. Dans ce cas, l'identifiant
correspondant est désactivé. Cette méthode convient pour le compte root. Mais
il faut pouvoir autoriser la gestion administrative ou la connexion de root d'une
autre manière, par exemple authentification avec clé SSH, ou sudo.

</para>
<para>
Un hachage MD5 pour le mot de passe peut être obtenu de la manière suivante.

<informalexample><screen>
$ echo "r00tme" | mkpasswd -s -H MD5
</screen></informalexample>

</para>

  </sect2>

  <sect2 id="preseed-bootloader">
  <title>Installation du programme d'amorçage</title>

<informalexample role="example"><screen>
# Grub est le programme d'amorçage par défaut (pour x86). Si vous préférez
# LILO, décommentez la ligne suivante :
#d-i grub-installer/skip boolean true

# Il n'y a aucun danger à donner ce paramètre : il installe grub sur le
# secteur d'amorçage principal s'il n'existe aucun autre système d'exploitation
# sur la machine.
d-i grub-installer/only_debian boolean true

# Ce paramètre installe grub sur le secteur d'amorçage principal même s'il
# existe un autre système d'exploitation, ce qui est moins sûr car il pourrait
# ne pas savoir amorcer cet autre système.
d-i grub-installer/with_other_os boolean true

# Vous pouvez aussi l'installer ailleurs que dans le secteur d'amorçage 
# principal. Décommentez et modifiez les lignes suivantes :
#d-i grub-installer/bootdev  string (hd0,0)
#d-i grub-installer/only_debian boolean false
#d-i grub-installer/with_other_os boolean false
</screen></informalexample>

  </sect2>

  <sect2 id="preseed-finish">
  <title>Terminer la première étape de l'installation</title>

<informalexample role="example"><screen>
# Pour éviter le dernier message disant que l'installation est terminée
d-i prebaseconfig/reboot_in_progress note

# Pour empêcher l'éjection du cédérom au moment du redémarrage,
# c'est utile parfois :
#d-i cdrom-detect/eject boolean false
</screen></informalexample>

  </sect2>
 </sect1>

 <sect1 id="preseed-stage2">
 <title>Préconfiguration de la deuxième partie de l'installation</title>

  <sect2 id="preseed-baseconfig">
  <title>Préconfiguration de base-config</title>

<informalexample role="example"><screen>
# Pour éviter le message d'introduction
base-config base-config/intro note

# Pour éviter le dernier message
base-config base-config/login note

# Si vous installez un gestionnaire d'affichage et si vous ne voulez pas le
# lancer immédiatemment après base-config :
#base-config base-config/start-display-manager boolean false

# Certaines versions de l'installateur peuvent dire ce que vous avez installé.
# Par défaut, rien n'est signalé. Mais l'envoi de rapport d'installation aide le projet
# à connaître les logiciels populaires. 
#popularity-contest popularity-contest/participate boolean false
</screen></informalexample>

  </sect2>

  <sect2 id="preseed-tasksel">
  <title>Choix des paquets</title>
<para>

Vous pouvez installer toute combinaison de tâches parmi celles disponibles.
Pour l'heure, les tâches disponibles sont les suivantes :
</para>

<itemizedlist>
<listitem><para>
  <userinput>Standard system</userinput>
</para></listitem>
<listitem><para>
  <userinput>Desktop environment</userinput>
</para></listitem>
<listitem><para>
  <userinput>Web server</userinput>
</para></listitem>
<listitem><para>
  <userinput>Print server</userinput>
</para></listitem>
<listitem><para>
  <userinput>DNS server</userinput>
</para></listitem>
<listitem><para>
  <userinput>File server</userinput>
</para></listitem>
<listitem><para>
  <userinput>Mail server</userinput>
</para></listitem>
<listitem><para>
  <userinput>SQL database</userinput>
</para></listitem>
<listitem><para>
  <userinput>Laptop</userinput>
</para></listitem>
<listitem><para>
  <userinput>manual package selection</userinput>
</para></listitem>
</itemizedlist>

<para>
Pour les dernières tâches, aptitude est utilisé. Vous pouvez aussi
choisir de n'installer aucune tâche et forcer l'installation de paquets par un autre moyen.
Il est recommandé de toujours inclure la tâche Système standard.
</para>

<informalexample role="example"><screen>
tasksel tasksel/first multiselect Standard system, Desktop environment
#tasksel tasksel/first multiselect Standard system, Web server
</screen></informalexample>

  </sect2>

  <sect2 id="preseed-mailer">
  <title>Configuration du MTA</title>
<para>
Pendant une installation normale, exim pose peu de questions. Voici
comment les éviter. Une préconfiguration plus complexe est possible.
</para>

<informalexample role="example"><screen>
exim4-config exim4/dc_eximconfig_configtype \
       select no configuration at this time
exim4-config exim4/no_config boolean true
exim4-config exim4/no_config boolean true
exim4-config exim4/dc_postmaster string
</screen></informalexample>

  </sect2>

  <sect2 id="preseed-X">
  <title>Configuration du serveur X</title>
<para>

Préconfigurer le serveur X est possible, mais vous devrez sans doute 
connaître les caractéristiques du matériel video de votre machine. Le
configurateur Debian du serveur X ne configure rien automatiquement.
</para>
<informalexample role="example"><screen>
# X peut détecter le bon pilote pour certaines cartes, mais si vous faites une
# préconfiguration, vous annulez ce qu'il aura choisi. Cependant vesa
# fonctionne la plupart du temps.
#xserver-xfree86 xserver-xfree86/config/device/driver select vesa

# Pour la détection automatique de la souris, il faut savoir que si elle
# échoue, X recommence sans fin le processus. Donc, s'il y a préconfiguration,
# une boucle infinie peut apparaître si la souris n'est pas détectée.
#xserver-xfree86 xserver-xfree86/autodetect_mouse boolean true

# La détection automatique du moniteur est recommandée.
xserver-xfree86 xserver-xfree86/autodetect_monitor boolean true
# Décommentez la ligne suivante si vous possédez un écran LCD.
#xserver-xfree86 xserver-xfree86/config/monitor/lcd boolean true
# X possède trois méthodes pour la configuration du moniteur. Voici comment
# présélectionner la méthode « medium », qui est toujours disponible.
# La méthode « simple » peut ne pas être disponible et la méthode
# « advanced » pose trop de questions.
xserver-xfree86 xserver-xfree86/config/monitor/selection-method \
       select medium
xserver-xfree86 xserver-xfree86/config/monitor/mode-list \
       select 1024x768 @ 60 Hz
</screen></informalexample>
</sect2>

  <sect2 id="preseed-other">
  <title>Les autres questions</title>

<informalexample role="example"><screen>
# Selon les logiciels que vous avez installés et s'il y a eu des problèmes
# pendant le processus d'installation, d'autres questions peuvent être posées.
# Vous pouvez bien sûr les préconfigurer ! Pour obtenir la liste de toutes
# les questions possibles, faites une installation, et exécutez ces 
# commandes :
#   debconf-get-selections --installer > fichier
#   debconf-get-selections >> fichier
</screen></informalexample>
</sect2>
</sect1>

 <sect1 id="preseed-advanced">
 <title>Options complexes</title>

  <sect2 id="preseed-shell">
  <title>Commandes Shell</title>

<informalexample role="example"><screen>
# La préconfiguration de l'installation n'est pas sécurisée. Rien dans 
# l'installateur ne vérifie que des dépassements de tampons ou des
# exploitations quelconques des valeurs données dans ce fichier n'ont pas lieu.
# N'utilisez que les fichiers dont vous connaissez la provenance !
# Pour tout dire, et parce que c'est en général utile, voici un
# moyen d'exécuter automatiquement une commande dans l'installateur.

# La première commande est exécutée aussi tôt que possible, juste après
# la lecture du fichier.
#d-i preseed/early_command string anna-install some-udeb

# Cette commande est exécutée juste avant que l'installation ne se termine,
# mais quand le répertoire /target est encore utilisable.
#d-i preseed/late_command string echo foo > /target/etc/bar

# Cette commande est exécutée au moment où base-config commence.
#base-config base-config/early_command string echo hi mom

# Cette commande est exécutée après base-config, juste avant la connexion.
# C'est un bon moyen d'installer les paquets que vous voulez ou d'affiner la
# la configuration du système.
#base-config base-config/late_command string \
#    apt-get install zsh; chsh -s /bin/zsh
</screen></informalexample>
</sect2>

  <sect2 id="preseed-chainload">
  <title>Chaîner les fichiers de préconfiguration</title>
<para>
Vous pouvez inclure dans ce fichier d'autres fichiers de
préconfiguration. Toutes les valeurs de ces fichiers annuleront les
valeurs préexistantes. Vous pouvez par exemple mettre la configuration du
réseau dans un fichier et certaines configurations plus spécifiques dans 
un autre fichier.
</para>

<informalexample><screen>
#Vous pouvez indiquer plus d'un fichier, en les séparant par des espaces ; 
#tous seront chargés. Ces fichiers peuvent à leur tour contenir d'autres 
#directives de préconfiguration ou d'inclusion. Notez que si les fichiers sont relatifs, 
#ils seront pris dans le répertoire où se trouve le fichier qui les inclut.
#d-i preseed/include string x.cfg

# L'installateur peut vérifier la somme de contrôle des fichiers de
# préconfiguration avant de les utiliser. Pour le moment, cette somme doit être
# de type md5sum. Il faut lister les sommes de contrôles dans le même ordre
# que les fichiers à inclure. 
#d-i preseed/include/checksum string 5da499872becccfeda2c4872f9171c3d

# D'une manière plus souple, cela exécute des commandes du shell et si le 
# résultat donne les noms de ces fichiers, ils sont inclus. 
#d-i preseed/include_command string \
#   string echo if [ "`hostname`" = bob ]; then echo bob.cfg; fi
</screen></informalexample>
</sect2>

</sect1>
</appendix>
