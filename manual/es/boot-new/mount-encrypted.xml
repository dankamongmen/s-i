<?xml version="1.0" encoding="ISO-8859-1"?>
<!-- original version: 41817 -->
<!-- movido por jfs, enero 2007 -->
<!-- revisado por Igor Tamara, enero 2007 -->

 <sect1 id="mount-encrypted-volumes">
 <title>Montaje de volúmenes cifrados</title>

<para>

Se le solicitará la contraseña para cada uno de los volúmenes cifrados
durante el arranque si ha creado volúmenes cifrados durante la
instalación y los ha asociado a puntos de montaje. El procedimiento
difiere ligeramente en función de si se utiliza «dm-crypt» o
«loop-AES».

</para>

  <sect2 id="mount-dm-crypt">
  <title>dm-crypt</title>

<para>

Se mostrará la siguiente indicación durante el arranque para las
particiones que están cifradas con «dm-crypt»:

<informalexample><screen>
Starting early crypto disks... <replaceable>part</replaceable>_crypt(starting)
Enter LUKS passphrase:
</screen></informalexample>

En la primera línea del indicador, <replaceable>part</replaceable> es
el nombre de la partición subyacente, p.ej. sda2 o md0.  La pregunta
que puede hacerse es ¿<emphasis>para qué volumen</emphasis> está
introduciendo la contraseña? ¿Se trata de <filename>/home</filename> o
de <filename>/var</filename>?  Por supuesto, si tiene solamente un
volumen cifrado es muy sencillo y sólo tendrá que introducir la clave
que utilizó cuando definía esta volumen. Las notas que escribió tras
el último paso en <xref linkend="partman-crypto"/> le serán ahora de
utilidad si configuró más de un volumen cifrado durante la
instalación. Si no tomo nota de la relación entre
<filename><replaceable>part</replaceable>_crypt</filename> y los
puntos de montaje anteriormente aún podrá encontrarla en los ficheros
<filename>/etc/crypttab</filename> y <filename>/etc/fstab</filename>
de su nuevo sistema

</para><para>

El indicador puede ser un poco distinto cuando lo que se monta es el
sistema de ficheros raíz. El mensaje exacto dependerá del generador de
initramfs que se utilizó para generar el initrd utilizado para el
arranque del sistema. El ejemplo que se muestra a continuación
corresponde al mensaje del initrd generado con
<classname>initramfs-tools</classname>:

<informalexample><screen>
Begin: Mounting <emphasis>root file system</emphasis>... ...
Begin: Running /scripts/local-top ...
Enter LUKS passphrase:
</screen></informalexample>

</para><para>

No se mostrará ningún carácter (ni siquiera asteriscos) mientras vd.
introduce la clave. Si introduce mal la clave tendrá dos intentos más
para corregirla. Después del tercer intento erróneo el proceso de
arranque saltará ese volumen y continuará intentando montar el
siguiente sistemas de ficheros.  Para más información consulte <xref
linkend="crypto-troubleshooting"/>.

</para><para>


El proceso de arranque debería continuar normalmente una vez haya introducido
todas las claves.

</para>
  </sect2>

  <sect2 id="mount-loop-aes">
  <title>loop-AES</title>
<para>

Se le mostrará el siguiente indicador durante el arranque en el caso
de que tenga particiones cifradas con «loop-AES»:

<informalexample><screen>
Checking loop-encrypted file systems.
Setting up /dev/loop<replaceable>X</replaceable> (/<replaceable>mountpoint</replaceable>)
Password:
</screen></informalexample>

No se mostrará ningún carácter (ni siquiera asteriscos) mientras vd.
introduce la clave. Si introduce mal la clave tendrá dos intentos más
para corregirla. Después del tercer intento erróneo el proceso de
arranque saltará ese volumen y continuará intentando montar el
siguiente sistemas de ficheros.  Para más información consulte <xref
linkend="crypto-troubleshooting"/>.

</para><para>

El proceso de arranque debería continuar normalmente una vez haya introducido
todas las claves.

</para>
  </sect2>

  <sect2 id="crypto-troubleshooting">
  <title>Solucionar problemas</title>

<para>

Tendrá que montar manualmente los volúmenes cifrados si no se pudieron montar
porque no introdujo bien la clave. Aquí se dan ciertos casos distintos:

</para>

<itemizedlist>
<listitem><para>

El primer caso está asociado a la partición raíz. El proceso de arranque no
podrá continuar y se parará si no se monta ésta correctamente, con lo que
tendrá que reiniciar el equipo e intentarlo de nuevo.

</para></listitem>
<listitem><para>

El caso más sencillo se da en los volúmenes cifrados que guardan datos
como pueda ser el caso de 
<filename>/home</filename> o <filename>/srv</filename>. Simplemente
puede intentar montarlo de nuevo tras el arranque. En el caso de
«loop-AES» se hace con una operación de un solo paso:

<informalexample><screen>
<prompt>#</prompt> <userinput>mount <replaceable>/punto_de_montaje</replaceable></userinput>
<prompt>Password:</prompt>
</screen></informalexample>

donde debería reemplazar <replaceable>/punto_de_montaje</replaceable> por el
directorio correspondiente (p.ej. <filename>/home</filename>).  La única
diferencia con el montaje normal de sistemas de ficheros es que se le
preguntará la contraseña para este volumen.

</para><para>

Es un poco más complicado para el caso de «dm-crypt». Primero tendrá 
que registrar los volúmenes con el <application>device mapper</application>
ejecutando:

<informalexample><screen>
<prompt>#</prompt> <userinput>/etc/init.d/cryptdisks start</userinput>
</screen></informalexample>

Esto hará que se sondeen todos los volúmenes descritos
en <filename>/etc/crypttab</filename> y se crearán todos los dispositivos
necesarios en el directorio <filename>/dev</filename> tras introducir
la contraseña correctamente. Se omitirán los volúmenes que ya estén
registrados por lo que puede repetir esta orden tantas veces como
necesite. Una vez que haya registrado con éxito el dispositivo sólo
tiene que montarlos de la forma habitual:

<informalexample><screen>
<prompt>#</prompt> <userinput>mount <replaceable>/punto_de_montaje</replaceable></userinput>
</screen></informalexample>

</para></listitem>
<listitem><para>

El sistema debería arrancar aún cuando no se puedan montar los
sistemas de ficheros que no contengan ficheros del sistema críticos
(<filename>/usr</filename> o <filename>/var</filename>). Por lo que debería
poder montar los volúmenes manualmente como se ha descrito anteriormente. Sin
embargo, tendrá que arrancar o reiniciar los servicios que se ejecutan en su
nivel de ejecución normal porque es muy probable que no se hayan podido
arrancar. La forma más fácil de conseguir ésto es cambiando al primer nivel de
ejecución y volver al nivel actual introduciendo lo siguiente:

<informalexample><screen>
<prompt>#</prompt> <userinput>init 1</userinput>
</screen></informalexample>

y en el indicador del intérprete de órdenes pulse
<keycombo> <keycap>Control</keycap> <keycap>D</keycap> </keycombo>
cuando se le pregunte la contraseña de root.

</para></listitem>
</itemizedlist>

  </sect2>
 </sect1>
