#!/bin/sh -e

. /usr/share/debconf/confmodule

logfile=/var/log/messages

localecode="debian-installer/locale"
languagecode="debian-installer/language"
countrycode="debian-installer/country"

log() {
    echo "languagechooser: info: $*" >> $logfile
}

db_title "Choose language"

#   debconf/language is an alias for debian-installer/language
db_register "$languagecode" "debconf/language"

db_fset "languagechooser/languagename" seen false
db_fset "$languagecode" seen false
db_input critical "languagechooser/languagename" || [ $? -eq 30 ]
if db_go; then
    db_get "languagechooser/languagename"
    if test "$RET" ; then
	LANGNAME="$RET"
	. languagemap
	db_set "$languagecode" "$LANGUAGELIST"
	db_set "$localecode"   "$LOCALE"
	db_set "$countrycode"  "$COUNTRY"
    else
	# Error, not sure how to handle it
	:
    fi
else
    # Error, not sure how to handle it
    :
fi

db_get "$languagecode"
db_set "debconf/language" "$LANGUAGELIST"

log "debian-installer/locale   = '$LOCALE'"
log "debian-installer/language = '$LANGUAGELIST'"
log "debian-installer/country  = '$COUNTRY'"

exit 0
